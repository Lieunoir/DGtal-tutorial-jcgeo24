<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>3D geometric estimations - DGtal tutorial jcgeo24</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../setup.html"><strong aria-hidden="true">1.</strong> Setup</a></li><li class="chapter-item expanded affix "><li class="part-title">Practicals</li><li class="chapter-item expanded "><a href="../thinning.html"><strong aria-hidden="true">2.</strong> Homotopic thinning</a></li><li class="chapter-item expanded "><a href="../estimators.html"><strong aria-hidden="true">3.</strong> Estimators and differential calculus</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../estimators/start.html"><strong aria-hidden="true">3.1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../estimators/estimations.html" class="active"><strong aria-hidden="true">3.2.</strong> 3D geometric estimations</a></li><li class="chapter-item expanded "><a href="../estimators/operators.html"><strong aria-hidden="true">3.3.</strong> Differential calculus operators</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DGtal tutorial jcgeo24</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="3d-geometric-estimations"><a class="header" href="#3d-geometric-estimations">3D geometric estimations</a></h1>
<p>This section shows how to estimate correctly the area of a digital object. We start by estimating a normal vector field on the surface, and then the global area is estimated through local computations.</p>
<p>Solutions can be found in <code>solutions/surface-estimators.cpp</code>.</p>
<p>The main part of the documentation for this practical is the one related to <a href="https://dgtal-team.github.io/doc-nightly/moduleShortcuts.html">shorcuts</a>. It provides you a lot of ready-to-use functions to load/build volume and surfaces, computes some geometric quantities, and export them.</p>
<details><summary>
Philosophy of <a href="https://dgtal-team.github.io/doc-nightly/moduleShortcuts.html">shortcuts</a> module
</summary>
This module hides as many as possible implementations details when dealing with digital and mesh surfaces. You pass with a `Parameter` object many informations to shorcuts. You specify the shape, the digitization gridstep, the radius parameter of an estimator, the chosen topology, which connected component you want, etc. The module also chooses what kind of digital surface you use.
`C++11` is very convenient with the `auto` keyword, which lets you largely ignore what object you are manipulating.
</details>
<h2 id="getting-a-normal-vector-field-onto-a-digital-surface"><a class="header" href="#getting-a-normal-vector-field-onto-a-digital-surface">Getting a normal vector field onto a digital surface</a></h2>
<p><a href="https://dgtal-team.github.io/doc-nightly/moduleShortcuts.html">shorcuts</a> offers you several ways to compute a normal vector field onto the whole digital surface or onto a part of it.</p>
<p>You can already view the "true" normal vector field of the implicit surface. It was computed and displayed with  these two lines</p>
<pre><code class="language-cpp">auto true_normals = SHG3::getNormalVectors( shape, K, surfels, params );
psMesh-&gt;addFaceVectorQuantity( "True normal vector field", true_normals );
</code></pre>
<p>There are several normal vector fields that are computable by shorcuts  (see <a href="https://dgtal-team.github.io/doc-nightly/moduleShortcuts.html#dgtal_shortcuts_sec3">philosophy of shorcuts module</a>):</p>
<ul>
<li><code>ShortcutsGeometry::getTrivialNormalVectors</code>: returns the trivial (T) normal vectors to the given surfel range</li>
<li><code>ShortcutsGeometry::getCTrivialNormalVectors</code>: returns the convolved trivial (CT) normal vectors to the given surfel range</li>
<li><code>ShortcutsGeometry::getVCMNormalVectors</code>: returns the Voronoi Covariance Measure (VCM) normal vectors to the given surfel range</li>
<li><code>ShortcutsGeometry::getIINormalVectors</code>: returns the Integral Invariant (II) normal vectors to the given surfel range (embedded in a binary image or a digitized implicit shape)</li>
</ul>
<p>Some of these methods are influenced by the <code>Parameter</code> object. However, they have default reasonnable values.</p>
<p><strong>Exercise</strong> : add computation of several normal vector fields
You  can for instance add the computation of the trivial (T),  the convolved trivial (CT) and integral invariant (II) normal estimator. If you wish to let the user choose, you can use <code>ImGui::RadioButton</code>.</p>
<pre><code class="language-cpp">  int Estimator;
...
  ImGui::RadioButton("Method 0", &amp;Estimator, 0); ImGui::SameLine();
  ImGui::RadioButton("Method 1", &amp;Estimator, 1); ImGui::SameLine();
  ImGui::RadioButton("Method 2", &amp;Estimator, 2);
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>(T) vector field of sphere $h=1$</th><th>(II) vector field of sphere $h=1$</th></tr></thead><tbody>
<tr><td><img src="https://codimd.math.cnrs.fr/uploads/upload_6fe5c1fed8c7759b055ab25deffc39d4.jpg" alt="trivial" /></td><td><img src="https://codimd.math.cnrs.fr/uploads/upload_86dc044de553b266d68c701beee903c8.jpg" alt="ii" /></td></tr>
</tbody></table>
</div>
<p><strong>Exercise (optional)</strong> : view errors in normal estimation
<a href="https://dgtal-team.github.io/doc-nightly/moduleShortcuts.html#dgtal_shortcuts_sec3">shorcuts</a> provides you method to compute the angle error between two unit vector field. You may observe where the angle error is big by adding a face scalar quantity to your mesh:</p>
<pre><code class="language-cpp">psMesh-&gt;addFaceScalarQuantity( "Angle error", angle_diff )
    -&gt;setMapRange( { 0.0, M_PI / 20.0 } ) // 10° is bad !
    -&gt;setColorMap( "coolwarm" );
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>(T) angle error of sphere \(h=1\)</th><th>(II) angle error of sphere \(h=1\)</th></tr></thead><tbody>
<tr><td><img src="https://codimd.math.cnrs.fr/uploads/upload_ac176359a314091d3d776495dfef3a65.jpg" alt="error-t-1" /></td><td><img src="https://codimd.math.cnrs.fr/uploads/upload_41c6742944c577a9754c25ef6186291e.jpg" alt="error-ii-1" /></td></tr>
</tbody></table>
</div>
<p><strong>Exercise (optional)</strong> : compute \(l_2\) and \(l_\infty\) errors in normal estimation</p>
<p>You can also compute the \(l_\infty\)-error of normal vector estimation, by computing the maximum of angle errors. For the \(l_2\)-error, the easiest way is to compute the squared root of the variance of angle errors. Use <code>ShorcutsGeometry::getStatistic</code> to get a statistic object from  your vector of angle errors.</p>
<p>For the <code>sphere9</code> object, you would get something like:</p>
<div class="table-wrapper"><table><thead><tr><th>sphere9</th><th>\(l_\infty\)-error (T)</th><th>\(l_\infty\)-error (CT)</th><th>\(l_\infty\)-error (II)</th></tr></thead><tbody>
<tr><td>\(h=1\)</td><td>1.516</td><td>0.141</td><td>0.139</td></tr>
<tr><td>\(h=0.5\)</td><td>1.543</td><td>0.190</td><td>0.077</td></tr>
<tr><td>\(h=0.25\)</td><td>1.557</td><td>0.183</td><td>0.041</td></tr>
<tr><td>Only the  (II) estimator looks multigrid convergent.</td><td></td><td></td><td></td></tr>
</tbody></table>
</div>
<h2 id="two-methods-for-estimating-the-area"><a class="header" href="#two-methods-for-estimating-the-area">Two methods for estimating the area</a></h2>
<p>We propose two methods for computing the area, both of them works with local summations involving normal vectors. Let \(\mathbf{X}\) be the smooth implicit shape, \(\mathbf{X}_h\) its Gauss digitization at step \(h\). Let us denote \((\mathbf{t}_i)\) the trivial normal vectors for each surfel \(i\), and \((\mathbf{u}_i)\) any one of your estimated normal vector field. We will also use \((\mathbf{n}_i)\) as the exact normal vector field (it is the true normal of the implicit surface at the nearest point to the surfel centroid).</p>
<ol>
<li>The first method, sometimes called Euler integration, takes the  scalar product of the trivial normal with the estimated normal (formula related to classical integration change of variables): \[
\widehat{\mathrm{Area}_1}(\mathbf{X}_h,h) := h^2 \sum_{\text{surfels}~i~\text{of}~X_h} \mathbf{t}_i  \cdot \mathbf{u}_i.
\]</li>
<li>The second method, proposed in <sup class="footnote-reference"><a href="#6">1</a></sup>, takes the inverse  of the $l_1$-norm of each estimated normal vector (formula related more to a statiscal analysis of digital planes): \[ \widehat{\mathrm{Area}_2}(\mathbf{X}_h,h) := h^2 \sum_{\text{surfels}~i~\text{of}~X_h} \frac{1}{|\mathbf{u}_i|_1}. \]</li>
</ol>
<p><strong>Exercise</strong>: Compute the estimated area using both methods
Use the formulas above and your normal vector fields to perform the area estimations. You may display the result in your GUI with something like:</p>
<pre><code class="language-cpp">ImGui::Text( "Area1=%f Area2=%f", Area1, Area2 );
</code></pre>
<p>For a sphere of radius \(r\), the true area is \(4 \pi r^2\), hence for <code>sphere9</code> , expect \(1017.87601976309300925456\).</p>
<h2 id="optional-checking-the-multigrid-convergence"><a class="header" href="#optional-checking-the-multigrid-convergence">(Optional) Checking the multigrid convergence</a></h2>
<p>A natural question is if these area estimates tends to the area of the Euclidean shape as the digitization gets finer and finer, aka are your area estimators <strong>multigrid convergent</strong> <sup class="footnote-reference"><a href="#3">2</a></sup> ?</p>
<p>For Euler integration method (method 1), Theorem 4 <sup class="footnote-reference"><a href="#5">3</a></sup> asserts that \(\widehat{\mathrm{Area}_1}\) estimator is multigrid convergent as long as the estimated normal vector field \(\mathbf{u}\) is itself convergent. The worst-case speed is then of the same order.</p>
<p>Convergence of (II) normal vector field is proven in <sup class="footnote-reference"><a href="#1">4</a></sup> and its speed of convergence is explicited in <sup class="footnote-reference"><a href="#4">5</a></sup>. Convergence of (VCM) normal vector field is proven in <sup class="footnote-reference"><a href="#2">6</a></sup>.</p>
<p>For method 2, it has been solely proven for the digitization of a plane. It is conjectured to be true too.</p>
<p>Let us find out if any our area estimators are indeed experimentally convergent. What speed of convergence do we get in practice ?</p>
<p><strong>Exercise</strong>: compute areas for a sequence of shapes with finer and finer digitization.
You may either use your GUI to compute by hand each error, or creates a new button that launches these computations, without creating a shape in the polyscope interface (copy/paste is your friend).</p>
<p>For a sphere object, you have easily the true area $A$, so the relative error is computed as \(\left|\frac{\widehat{\mathrm{Area}_k}(\mathbf{X}_h,h)-A}{A}\right|\).</p>
<p>For other shapes, you can have an idea of the convergence by using the area estimator with  the true normal vector field \(\mathbf{n}\). In some sense, you cannot expect a better result at the given  resolution.</p>
<p>The  table below displays the relative error for method 1 (Euler Integration):</p>
<div class="table-wrapper"><table><thead><tr><th><code>sphere9</code></th><th>\( \mathbf{u}= \)(T)</th><th>\( \mathbf{u}= \)(CT)</th><th>\( \mathbf{u}= \)(II)</th></tr></thead><tbody>
<tr><td>\(h=1\)</td><td>\(49.134\)%</td><td>\(3.200\)%</td><td>\(0.369\)%</td></tr>
<tr><td>\(h=0.5\)</td><td>\(48.692\)%</td><td>\(5.469\)%</td><td>\(0.335\)%</td></tr>
<tr><td>\(h=0.25\)</td><td>\(49.319\)%</td><td>\(4.645\)%</td><td>\(0.105\)%</td></tr>
<tr><td>\(h=0.125\)</td><td>...</td><td></td><td></td></tr>
</tbody></table>
</div>
<ul>
<li>Is method 1 before than method 2 ?</li>
<li>What is  the speed of convergence (hint: display graph with gnuplot in logscale) ?</li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">4</sup>
<p>D. Coeurjolly, J.-O. Lachaud, and J. Levallois. Multigrid convergent principal curvature estimators in digital geometry. Computer Vision and Image Understanding, 129 :27 – 41, 2014.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">6</sup>
<p>L. Cuel, J.-O. Lachaud, Q. Mérigot, and B. Thibert. Robust geometry estimation using the generalized voronoi covariance measure. SIAM Journal on Imaging Sciences, 8(2) :1293–1314, 2015.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">2</sup>
<p>R. Klette and J. Žunic ́. Multigrid convergence of calculated features in image analysis. Journal of Mathematical Imaging and Vision, 13(3) :173–191, 2000.</p>
</div>
<div class="footnote-definition" id="4"><sup class="footnote-definition-label">5</sup>
<p>J.-O. Lachaud, D. Coeurjolly, and J. Levallois. Robust and convergent curvature and normal estimators with digital integral invariants. In L. Najman and P. Romon, editors,Modern Approaches to Discrete Curvature, volume 2184 of Lecture Notes in Mathema- tics, pages 293–348. Springer International Publishing, Cham, 2017.</p>
</div>
<div class="footnote-definition" id="5"><sup class="footnote-definition-label">3</sup>
<p>J.-O. Lachaud and B. Thibert. Properties of gauss digitized shapes and digital surface integration. Journal of Mathematical Imaging and Vision, 54(2) :162–180, 2016.</p>
</div>
<div class="footnote-definition" id="6"><sup class="footnote-definition-label">1</sup>
<p>J.-O. Lachaud and A. Vialard. Geometric measures on arbitrary dimensional digital surfaces. In G. Sanniti di Baja, S. Svensson, and I. Nyström, editors, Proc. Int. Conf. Discrete Geometry for Computer Imagery (DGCI’2003), Napoli, Italy, volume 2886 of LNCS, pages 434–443. Springer, 2003.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../estimators/start.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../estimators/operators.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../estimators/start.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../estimators/operators.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
